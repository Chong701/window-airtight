<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°”å¯†æ€§å¤§æ•°æ®AIåŠ©æ‰‹</title>
    <style>
        :root { --primary: #3b82f6; --success: #10b981; --bg: #f8fafc; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); margin: 0; display: flex; justify-content: center; padding: 20px; }
        .app-card { background: white; width: 100%; max-width: 450px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); padding: 28px; }
        
        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { font-size: 1.6rem; color: #1e293b; margin: 0; }
        .header p { color: #64748b; font-size: 0.9rem; margin-top: 8px; }

        /* ä¸Šä¼ åŒºåŸŸ */
        .upload-section { border: 2px dashed #cbd5e1; background: #f1f5f9; padding: 25px; border-radius: 16px; text-align: center; cursor: pointer; transition: all 0.3s; margin-bottom: 25px; }
        .upload-section:hover { border-color: var(--primary); background: #eff6ff; }
        .data-status { margin-top: 10px; display: none; font-size: 0.85rem; font-weight: bold; color: var(--primary); }

        /* è¡¨å•åŒºåŸŸ */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; color: #334155; }
        input, select { width: 100%; padding: 14px; border: 1.5px solid #e2e8f0; border-radius: 12px; font-size: 1rem; box-sizing: border-box; }
        
        .predict-btn { width: 100%; padding: 16px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .predict-btn:disabled { background: #cbd5e1; cursor: not-allowed; }

        /* å¼¹çª—æ ·å¼ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; width: 85%; max-width: 350px; padding: 30px; border-radius: 24px; text-align: center; box-shadow: 0 20px 40px rgba(0,0,0,0.2); }
        .result-val { font-size: 2.5rem; font-weight: bold; color: var(--primary); margin: 15px 0; }
        .close-btn { background: #f1f5f9; color: #334155; padding: 12px 25px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 15px; }
    </style>
</head>
<body>

<div class="app-card">
    <div class="header">
        <h1>ğŸ“Š æ°”å¯†æ€§ AI è®­ç»ƒèˆ±</h1>
        <p>åŸºäºç°æœ‰å¤§æ•°æ®æ–‡ä»¶è¿›è¡Œæ™ºèƒ½é¢„æµ‹</p>
    </div>

    <div class="upload-section" onclick="document.getElementById('csvFile').click()">
        <div id="uploadText">
            <strong>ç‚¹å‡»å¯¼å…¥ CSV æ•°æ®æ–‡ä»¶</strong>
            <p style="font-size: 0.8rem; color: #64748b;">æ”¯æŒè¯»å–ï¼šç¼é•¿ã€å¯†å°å±‚æ•°ã€æµ‹è¯•ç»“æœ</p>
        </div>
        <input type="file" id="csvFile" accept=".csv" style="display: none">
        <div id="dataBadge" class="data-status">å·²å­¦ä¹  0 æ¡å†å²è®°å½•</div>
    </div>

    <div class="form-group">
        <label>å¾…æµ‹ç¼é•¿ (mm)</label>
        <input type="number" id="inputFc" placeholder="ä¾‹å¦‚: 5000">
    </div>

    <div class="form-group">
        <label>å¯†å°å±‚æ•° (å±‚)</label>
        <select id="inputLy">
            <option value="1">1å±‚</option>
            <option value="2" selected>2å±‚</option>
            <option value="3">3å±‚</option>
            <option value="4">4å±‚</option>
        </select>
    </div>

    <button id="calcBtn" class="predict-btn" onclick="runAI()" disabled>è¯·å…ˆå¯¼å…¥è®­ç»ƒæ•°æ®</button>
</div>

<div id="resModal" class="modal">
    <div class="modal-content">
        <div style="color: #64748b; font-size: 0.9rem;">AI æ™ºèƒ½é¢„æµ‹ç»“æœ</div>
        <div id="resVal" class="result-val">0.00</div>
        <div style="font-size: 0.9rem; color: #64748b; margin-bottom: 20px;">å•ä½ç¼é•¿æ¸—é€é‡ (mÂ³/m)</div>
        <div id="resAdvice" style="font-size: 0.85rem; color: #1e293b; background: #f8fafc; padding: 10px; border-radius: 8px;">æ•°æ®åˆ†æä¸­...</div>
        <button class="close-btn" onclick="closeModal()">ç¡®è®¤</button>
    </div>
</div>

<script>
    let modelData = []; // å­˜å‚¨è§£æåçš„æ•°æ®

    // --- æ–‡ä»¶è§£æé€»è¾‘ ---
    document.getElementById('csvFile').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(event) {
            const text = event.target.result;
            const rows = text.split('\n');
            modelData = [];

            // å¾ªç¯è§£æ CSVï¼ˆè·³è¿‡æ ‡é¢˜è¡Œï¼‰
            for (let i = 1; i < rows.length; i++) {
                const cols = rows[i].split(',');
                // å¯¹åº”ä½ çš„æ–‡ä»¶ç»“æ„ï¼š[0]åºå·, [1]ç¼é•¿, [2]å±‚æ•°, [3]æµ‹è¯•ç»“æœ
                if (cols.length >= 4) {
                    const fc = parseFloat(cols[1]);
                    const ly = parseFloat(cols[2]);
                    const res = parseFloat(cols[3]);
                    
                    if (!isNaN(fc) && !isNaN(ly) && !isNaN(res)) {
                        modelData.push({ fc, ly, res });
                    }
                }
            }

            if (modelData.length > 0) {
                updateUIReady();
            } else {
                alert("æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®æˆ–æ•°æ®ä¸ºç©º");
            }
        };
        reader.readAsText(file);
    });

    function updateUIReady() {
        document.getElementById('uploadText').style.display = 'none';
        const badge = document.getElementById('dataBadge');
        badge.style.display = 'block';
        badge.innerText = `âœ… æ¨¡å‹å·²å°±ç»ª (å·²å­¦ä¹  ${modelData.length} ç»„æ•°æ®)`;
        
        const btn = document.getElementById('calcBtn');
        btn.disabled = false;
        btn.innerText = "åŸºäº AI å¤§æ•°æ®é¢„æµ‹";
    }

    // --- AI é¢„æµ‹ç®—æ³• ---
    function runAI() {
        const targetFc = parseFloat(document.getElementById('inputFc').value);
        const targetLy = parseFloat(document.getElementById('inputLy').value);

        if (!targetFc) { alert("è¯·è¾“å…¥å¾…æµ‹ç¼é•¿"); return; }

        // è®¡ç®—å¤§æ•°æ®ä¸­çš„å¹³å‡è¡¨ç°ç³»æ•° (ç»“æœ/ç¼é•¿/å±‚æ•°å€’æ•°)
        // è¿™æ˜¯ä¸€ç§ç®€åŒ–çš„åŠ æƒçº¿æ€§ç®—æ³•
        let totalCoefficient = 0;
        modelData.forEach(item => {
            // å‡è®¾ 1/å±‚æ•° ä¸æ¸—é€é‡æ­£ç›¸å…³
            totalCoefficient += item.res / (item.fc * (1/item.ly));
        });
        
        const avgCoefficient = totalCoefficient / modelData.length;
        
        // æ‰§è¡Œé¢„æµ‹ï¼šé¢„æµ‹å€¼ = å¹³å‡ç³»æ•° * è¾“å…¥ç¼é•¿ * (1/è¾“å…¥å±‚æ•°)
        let finalResult = avgCoefficient * targetFc * (1/targetLy);

        // æ¸²æŸ“ç»“æœ
        showModal(finalResult.toFixed(3));
    }

    function showModal(val) {
        document.getElementById('resVal').innerText = val;
        document.getElementById('resModal').style.display = 'flex';
        
        let advice = "";
        if(val < 0.3) advice = "æ°”å¯†æ°´å¹³æä½³ï¼šä¼˜äºæ•°æ®åº“ 80% çš„è®°å½•ã€‚";
        else if(val < 0.45) advice = "æ°”å¯†æ°´å¹³ä¸€èˆ¬ï¼šå±äºæ ‡å‡†èŒƒå›´ã€‚";
        else advice = "æ°”å¯†æ°´å¹³åå¼±ï¼šå»ºè®®å¢åŠ å¯†å°å±‚æ•°ã€‚";
        document.getElementById('resAdvice').innerText = advice;
    }

    function closeModal() {
        document.getElementById('resModal').style.display = 'none';
    }
</script>
        
</body>
</html>
