<script>
    function calculate() {
        // 获取所有元素
        const elOutDb = document.getElementById('outDb');
        const elInDb = document.getElementById('inDb');
        const elOutT = document.getElementById('outTemp');
        const elInT = document.getElementById('inTemp');
        const typeScore = parseInt(document.getElementById('type').value);

        // 检查是否存在空值
        if (!elOutDb.value || !elInDb.value || !elOutT.value || !elInT.value) {
            alert("⚠️ 请填写完整数据：分贝和温度都需要输入数值。");
            return;
        }

        const outDb = parseFloat(elOutDb.value);
        const inDb = parseFloat(elInDb.value);
        const outT = parseFloat(elOutT.value);
        const inT = parseFloat(elInT.value);

        // 逻辑计算
        let deltaDb = outDb - inDb;
        let deltaT = Math.abs(outT - inT);
        
        let noiseScore = (deltaDb / 40) * 60; 
        let tempDeduction = (deltaT > 15 && deltaDb < 20) ? 15 : 0;

        let finalScore = Math.round(noiseScore + typeScore - tempDeduction);
        finalScore = Math.max(0, Math.min(100, finalScore));

        // 调用显示弹窗
        showResult(finalScore, deltaDb, deltaT);
    }

    function showResult(score, dDb, dT) {
        const modal = document.getElementById('resultModal');
        if (!modal) {
            alert("错误：找不到弹出框组件");
            return;
        }
        
        document.getElementById('scoreCircle').innerText = score;
        
        let color = score > 80 ? '#22c55e' : (score > 50 ? '#f59e0b' : '#ef4444');
        document.getElementById('scoreCircle').style.borderColor = color;
        document.getElementById('scoreCircle').style.color = color;

        let level = "";
        let advice = "";

        if (score > 80) {
            level = "气密性：优秀";
            advice = `隔音降噪 ${dDb}分贝，表现完美。`;
        } else if (score > 50) {
            level = "气密性：良好";
            advice = `基本合格，大风天注意观察窗缝。`;
        } else {
            level = "气密性：较差";
            advice = `降噪仅 ${dDb}分贝，建议检查胶条老化情况。`;
        }

        document.getElementById('levelText').innerText = level;
        document.getElementById('adviceText').innerText = advice;
        modal.style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('resultModal').style.display = 'none';
    }
</script>

</body>
</html>
